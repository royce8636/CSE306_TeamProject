#include <stdio.h>
#include <bcm2835.h>

// Define the motor control pins
#define AIN1 RPI_GPIO_P1_3
#define AIN2 RPI_GPIO_P1_5
#define STBY RPI_GPIO_P1_7
#define BIN1 RPI_GPIO_P1_11
#define BIN2 RPI_GPIO_P1_13

// Define the motor speeds
#define LEFT_SPEED 150
#define RIGHT_SPEED 150

// Define the duration to run the motors in milliseconds
#define DURATION 5000

int main()
{
  // Initialize bcm2835 library
  if (!bcm2835_init())
  {
    printf("Error initializing bcm2835.\n");
    return 1;
  }

  // Set the motor control pins as outputs
  bcm2835_gpio_fsel(AIN1, BCM2835_GPIO_FSEL_OUTP);
  bcm2835_gpio_fsel(AIN2, BCM2835_GPIO_FSEL_OUTP);
  bcm2835_gpio_fsel(STBY, BCM2835_GPIO_FSEL_OUTP);
  bcm2835_gpio_fsel(BIN1, BCM2835_GPIO_FSEL_OUTP);
  bcm2835_gpio_fsel(BIN2, BCM2835_GPIO_FSEL_OUTP);

  // Enable the motors
  bcm2835_gpio_write(STBY, HIGH);

  // Set the motor directions to go forward
  bcm2835_gpio_write(AIN1, HIGH);
  bcm2835_gpio_write(AIN2, LOW);
  bcm2835_gpio_write(BIN1, HIGH);
  bcm2835_gpio_write(BIN2, LOW);

  // Set the motor speeds
  bcm2835_pwm_set_clock(BCM2835_PWM_CLOCK_DIVIDER_16);
  bcm2835_pwm_set_mode(0, 1, 1);
  bcm2835_pwm_set_mode(1, 1, 1);
  bcm2835_pwm_set_range(0, 100);
  bcm2835_pwm_set_range(1, 100);
  bcm2835_pwm_set_data(0, LEFT_SPEED);
  bcm2835_pwm_set_data(1, RIGHT_SPEED);

  // Wait for the specified duration
  bcm2835_delay(DURATION);

  // Stop the motors
  bcm2835_pwm_set_data(0, 0);
  bcm2835_pwm_set_data(1, 0);

  // Disable the motors
  bcm2835_gpio_write(STBY, LOW);

  // Close bcm2835 library
  bcm2835_close();

  return 0;
}

